# í”„ë¡œì íŠ¸ ì—…ë°ì´íŠ¸ ë‚´ì—­ - 2025ë…„ 10ì›” 28ì¼

## ğŸ“‹ ì—…ë°ì´íŠ¸ ê°œìš”

**ì‘ì—…ì¼**: 2025ë…„ 10ì›” 28ì¼
**ì‘ì—…ì**: Claude AI
**ì—…ë°ì´íŠ¸ ì†ŒìŠ¤**: `C:\dev\springboot\shoppy-fullstack-app\backend\src\main`
**ì ìš© ëŒ€ìƒ**: `C:\dev\ecommerce-fullstack-app\backend\src\main`
**ëª©ì **: ìˆ˜ì—…ì—ì„œ ë°°ìš´ ìµœì‹  ê¸°ëŠ¥(ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ, ì£¼ë¬¸ ê´€ë¦¬, ê³ ê° ì§€ì›) ë©”ì¸ í”„ë¡œì íŠ¸ ë°˜ì˜

---

## ğŸ¯ ì£¼ìš” ë³€ê²½ì‚¬í•­ ìš”ì•½

### ì‹ ê·œ ê¸°ëŠ¥ ì¶”ê°€ (3ê°œ)
1. **ì¹´ì¹´ì˜¤í˜ì´ QR ê²°ì œ ì‹œìŠ¤í…œ** - ì˜¨ë¼ì¸ ê²°ì œ ê¸°ëŠ¥ í†µí•©
2. **ì£¼ë¬¸ ê´€ë¦¬ ì‹œìŠ¤í…œ** - ì£¼ë¬¸ ì €ì¥ ë° ì£¼ë¬¸ ìƒì„¸ ê´€ë¦¬
3. **ê³ ê° ì§€ì› ì‹œìŠ¤í…œ** - FAQ, ê³µì§€ì‚¬í•­, ë¬¸ì˜ ê²Œì‹œíŒ

### ê¸°ì¡´ ê¸°ëŠ¥ ê°œì„ 
1. **ì¥ë°”êµ¬ë‹ˆ ì‹œìŠ¤í…œ ê°œì„ ** - ë°ì´í„°ë² ì´ìŠ¤ ë·° í™œìš©, ì„±ëŠ¥ ìµœì í™”
2. **ë³´ì•ˆ ì„¤ì • ì—…ë°ì´íŠ¸** - ì‹ ê·œ ì—”ë“œí¬ì¸íŠ¸ í—ˆìš© ì¶”ê°€
3. **DTO êµ¬ì¡° ê°œì„ ** - ê´€ì‹¬ì‚¬ ë¶„ë¦¬ (CartItem â†” CartListResponse)

---

## ğŸ“¦ ìƒì„±ëœ íŒŒì¼ ëª©ë¡ (18ê°œ)

### 1. DTO í´ë˜ìŠ¤ (5ê°œ)

#### KakaoPay.java
**ìœ„ì¹˜**: `dto/KakaoPay.java`
**ì„¤ëª…**: ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì •ë³´ ë°ì´í„° ì „ì†¡ ê°ì²´
```java
- orderId: ì£¼ë¬¸ë²ˆí˜¸ (UUID)
- userId: ì‚¬ìš©ì ID
- itemName: ìƒí’ˆëª…
- qty: ìˆ˜ëŸ‰
- totalAmount: ì´ ê¸ˆì•¡
- receiver: ìˆ˜ë ¹ì¸ ì •ë³´ (ë‚´ë¶€ í´ë˜ìŠ¤)
- paymentInfo: ê²°ì œ ì •ë³´ (ë‚´ë¶€ í´ë˜ìŠ¤)
- cidList: ì¥ë°”êµ¬ë‹ˆ ID ë¦¬ìŠ¤íŠ¸
```

#### KakaoReadyResponse.java
**ìœ„ì¹˜**: `dto/KakaoReadyResponse.java`
**ì„¤ëª…**: ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì¤€ë¹„ ì‘ë‹µ DTO
```java
- tid: ê²°ì œ ê³ ìœ  ë²ˆí˜¸
- next_redirect_pc_url: QR ì½”ë“œ URL
```

#### KakaoApproveResponse.java
**ìœ„ì¹˜**: `dto/KakaoApproveResponse.java`
**ì„¤ëª…**: ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ìŠ¹ì¸ ì‘ë‹µ DTO
```java
- tid: ê²°ì œ ê³ ìœ  ë²ˆí˜¸
- cid: ê°€ë§¹ì  ì½”ë“œ
- status: ê²°ì œ ìƒíƒœ
- partnerOrderId: ê°€ë§¹ì  ì£¼ë¬¸ë²ˆí˜¸
- partnerUserId: ê°€ë§¹ì  íšŒì› ID
- paymentMethodType: ê²°ì œ ìˆ˜ë‹¨
- amount: ê²°ì œ ê¸ˆì•¡ ìƒì„¸ (ë‚´ë¶€ í´ë˜ìŠ¤)
- approvedAt: ìŠ¹ì¸ ì‹œê°
```
**íŠ¹ì§•**: @JsonNaming(SnakeCaseStrategy.class) ì‚¬ìš©

#### Support.java
**ìœ„ì¹˜**: `dto/Support.java`
**ì„¤ëª…**: ê³ ê° ì§€ì› ê²Œì‹œê¸€ DTO
```java
- sid: ì§€ì› ID
- title: ì œëª©
- content: ë‚´ìš©
- stype: ì§€ì› íƒ€ì… (all, faq, notice, general)
- hits: ì¡°íšŒìˆ˜
- rdate: ë“±ë¡ì¼
```

#### CartListResponse.java
**ìœ„ì¹˜**: `dto/CartListResponse.java`
**ì„¤ëª…**: ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ ì¡°íšŒ ì‘ë‹µ DTO (íšŒì›+ìƒí’ˆ+ì¥ë°”êµ¬ë‹ˆ í†µí•©)
```java
- id: íšŒì› ID
- mname: íšŒì› ì´ë¦„
- phone: ì „í™”ë²ˆí˜¸
- email: ì´ë©”ì¼
- pid: ìƒí’ˆ ID
- name: ìƒí’ˆëª…
- info: ìƒí’ˆ ì •ë³´
- image: ì´ë¯¸ì§€
- price: ê°€ê²©
- size: ì‚¬ì´ì¦ˆ
- qty: ìˆ˜ëŸ‰
- cid: ì¥ë°”êµ¬ë‹ˆ ID
- totalPrice: ì´ ê°€ê²©
```

---

### 2. Controller í´ë˜ìŠ¤ (2ê°œ)

#### KakaoPayController.java
**ìœ„ì¹˜**: `controller/KakaoPayController.java`
**ê²½ë¡œ**: `/payment`

**ì—”ë“œí¬ì¸íŠ¸**:
- `POST /payment/kakao/ready` - ê²°ì œ ì¤€ë¹„ (QR ì½”ë“œ ìƒì„±)
- `GET /payment/qr/success?orderId={orderId}&pg_token={token}` - ê²°ì œ ì„±ê³µ ì½œë°±
- `GET /payment/qr/cancel?orderId={orderId}` - ê²°ì œ ì·¨ì†Œ ì½œë°±
- `GET /payment/qr/fail?orderId={orderId}` - ê²°ì œ ì‹¤íŒ¨ ì½œë°±

**ì£¼ìš” ê¸°ëŠ¥**:
```java
- UUID ê¸°ë°˜ ì£¼ë¬¸ë²ˆí˜¸ ìë™ ìƒì„±
- ì¹´ì¹´ì˜¤í˜ì´ API í˜¸ì¶œ (KakaoPayService)
- ê²°ì œ ì™„ë£Œ ì‹œ ì£¼ë¬¸ ì €ì¥ (OrderService)
- í”„ë¡ íŠ¸ì—”ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬
```

#### SupportController.java
**ìœ„ì¹˜**: `controller/SupportController.java`
**ê²½ë¡œ**: `/support`

**ì—”ë“œí¬ì¸íŠ¸**:
- `POST /support/list` - ê³ ê° ì§€ì› ëª©ë¡ ì¡°íšŒ

**ì£¼ìš” ê¸°ëŠ¥**:
```java
- ì „ì²´ ëª©ë¡ ì¡°íšŒ (stype="all")
- íƒ€ì…ë³„ í•„í„°ë§ ì¡°íšŒ (stype="faq", "notice", "general")
```

---

### 3. Service í´ë˜ìŠ¤ (5ê°œ)

#### KakaoPayService.java
**ìœ„ì¹˜**: `service/KakaoPayService.java`

**ì£¼ìš” ë©”ì„œë“œ**:
```java
- kakaoPayReady(KakaoPay): ê²°ì œ ì¤€ë¹„ API í˜¸ì¶œ
- approve(tid, userId, orderId, pgToken): ê²°ì œ ìŠ¹ì¸ API í˜¸ì¶œ
- findByTid(orderId): TID ì¡°íšŒ
- findByUserId(orderId): ì‚¬ìš©ì ID ì¡°íšŒ
```

**ê¸°ìˆ  ìŠ¤íƒ**:
- RestTemplate: ì¹´ì¹´ì˜¤í˜ì´ API í†µì‹ 
- ConcurrentHashMap: TID ë° ì‚¬ìš©ì ì •ë³´ ì„ì‹œ ì €ì¥
- @Value: application.yml ì„¤ì • ì£¼ì…

**ì¹´ì¹´ì˜¤í˜ì´ API ì„¤ì •**:
```yaml
kakao.pay.host: https://kapi.kakao.com
kakao.pay.admin-key: ê´€ë¦¬ì í‚¤
kakao.pay.cid: ê°€ë§¹ì  ì½”ë“œ
```

#### OrderService.java & OrderServiceImpl.java
**ìœ„ì¹˜**: `service/OrderService.java`, `service/OrderServiceImpl.java`

**ì£¼ìš” ë©”ì„œë“œ**:
```java
- save(KakaoPay): ì£¼ë¬¸ ì €ì¥ (@Transactional)
  1. orders í…Œì´ë¸”ì— ì£¼ë¬¸ ì •ë³´ ì €ì¥
  2. order_detail í…Œì´ë¸”ì— ì£¼ë¬¸ ìƒì„¸ ì €ì¥
  3. cart í…Œì´ë¸”ì—ì„œ ì£¼ë¬¸ ìƒí’ˆ ì‚­ì œ
```

**íŠ¸ëœì­ì…˜ ì²˜ë¦¬**:
- @Transactional ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©
- 3ê°€ì§€ ì‘ì—…ì˜ ì›ìì„± ë³´ì¥ (All or Nothing)

#### SupportService.java & SupportServiceImpl.java
**ìœ„ì¹˜**: `service/SupportService.java`, `service/SupportServiceImpl.java`

**ì£¼ìš” ë©”ì„œë“œ**:
```java
- findAll(Support): ê³ ê° ì§€ì› ëª©ë¡ ì¡°íšŒ
  - stype="all": ì „ì²´ ì¡°íšŒ
  - stype ê°’ì´ ìˆìœ¼ë©´: íƒ€ì…ë³„ ì¡°íšŒ
```

---

### 4. Repository í´ë˜ìŠ¤ (4ê°œ)

#### OrderRepository.java & JdbcTemplateOrderRepository.java
**ìœ„ì¹˜**: `repository/OrderRepository.java`, `repository/JdbcTemplateOrderRepository.java`

**ì£¼ìš” ë©”ì„œë“œ**:
```java
- saveOrders(KakaoPay): orders í…Œì´ë¸”ì— ì£¼ë¬¸ ì •ë³´ ì €ì¥
- saveOrderDetail(KakaoPay): order_detail í…Œì´ë¸”ì— ì£¼ë¬¸ ìƒì„¸ ì €ì¥
- deleteCartItem(List<Integer> cidList): ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ì‚­ì œ
```

**SQL ì¿¼ë¦¬**:
```sql
-- saveOrders
INSERT INTO orders(
    order_code, member_id, shipping_fee, discount_amount, total_amount,
    receiver_name, receiver_phone, zipcode, address1, address2, memo, odate
) VALUES (?,?,?,?,?,?,?,?,?,?,?, now())

-- saveOrderDetail (NamedParameterJdbcTemplate ì‚¬ìš©)
INSERT INTO order_detail(order_code, pid, pname, size, qty, pid_total_price, discount)
SELECT :orderCode, pid, name, size, qty, totalPrice, :discount
FROM view_cartlist
WHERE cid IN (:cidList)

-- deleteCartItem
DELETE FROM cart WHERE cid IN (:cidList)
```

#### SupportRepository.java & JdbcTemplateSupportRepository.java
**ìœ„ì¹˜**: `repository/SupportRepository.java`, `repository/JdbcTemplateSupportRepository.java`

**ì£¼ìš” ë©”ì„œë“œ**:
```java
- findAll(): ì „ì²´ ì§€ì› ëª©ë¡ ì¡°íšŒ
- findAll(Support): íƒ€ì…ë³„ ì§€ì› ëª©ë¡ ì¡°íšŒ
```

**SQL ì¿¼ë¦¬**:
```sql
-- ì „ì²´ ì¡°íšŒ
SELECT sid, title, stype, hits, rdate FROM support

-- íƒ€ì…ë³„ ì¡°íšŒ
SELECT sid, title, stype, hits, rdate FROM support WHERE stype = ?
```

---

### 5. ì„¤ì • íŒŒì¼ (2ê°œ)

#### application.yml (ì‹ ê·œ)
**ìœ„ì¹˜**: `src/main/resources/application.yml`

```yaml
kakao:
  pay:
    host: https://kapi.kakao.com
    admin-key: ed1df4b9d47e4cb603d7dbc8e7124cbb  # í…ŒìŠ¤íŠ¸ìš©
    cid: TC0ONETIME                              # í…ŒìŠ¤íŠ¸ ê°€ë§¹ì  ì½”ë“œ
    ready-path: /payment/ready
    approve-path: /payment/approve
```

**ì£¼ì˜ì‚¬í•­**:
- admin-keyëŠ” í…ŒìŠ¤íŠ¸ìš©ì…ë‹ˆë‹¤
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬ ê¶Œì¥
- TC0ONETIMEì€ ì¹´ì¹´ì˜¤í˜ì´ í…ŒìŠ¤íŠ¸ ê°€ë§¹ì  ì½”ë“œ

#### migration_update.sql (ì‹ ê·œ)
**ìœ„ì¹˜**: `database/migration_update.sql`

**ìƒì„±ë˜ëŠ” ê°ì²´**:
1. orders í…Œì´ë¸” (ì£¼ë¬¸ ì •ë³´)
2. order_detail í…Œì´ë¸” (ì£¼ë¬¸ ìƒì„¸)
3. support í…Œì´ë¸” (ê³ ê° ì§€ì›)
4. view_cartlist ë·° (ì¥ë°”êµ¬ë‹ˆ í†µí•© ë·°)

**ì‹¤í–‰ ë°©ë²•**:
```bash
mysql -u root -p < C:\dev\ecommerce-fullstack-app\database\migration_update.sql
```

---

## ğŸ”§ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡ (7ê°œ)

### 1. SecurityConfig.java
**ìœ„ì¹˜**: `config/SecurityConfig.java`
**ë³€ê²½ ë¼ì¸**: Line 29

**ë³€ê²½ ì „**:
```java
.requestMatchers("/member/**", "/product/**", "/cart/**").permitAll()
```

**ë³€ê²½ í›„**:
```java
.requestMatchers("/member/**", "/product/**", "/cart/**", "/support/**","/payment/**").permitAll()
```

**ë³€ê²½ ì´ìœ **: ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ í—ˆìš© ì¶”ê°€

---

### 2. CartItem.java
**ìœ„ì¹˜**: `dto/CartItem.java`
**ë³€ê²½ ë¼ì¸**: Line 15

**ë³€ê²½ ì „**:
```java
private int checkQty;
private String type;

// Product information (from join)
private String image;
private String name;
private int price;
```

**ë³€ê²½ í›„**:
```java
private int checkQty;
private String type;
private int sumQty;
```

**ë³€ê²½ ì´ìœ **:
- Product ì •ë³´ëŠ” CartListResponseë¡œ ë¶„ë¦¬
- sumQty í•„ë“œ ì¶”ê°€ (ì´ ìˆ˜ëŸ‰ ì¡°íšŒìš©)
- ê´€ì‹¬ì‚¬ ë¶„ë¦¬ (SRP ì›ì¹™)

---

### 3. CartRepository.java
**ìœ„ì¹˜**: `repository/CartRepository.java`

**ë³€ê²½ ì „**:
```java
public interface CartRepository {
    int updateQty(CartItem cartItem);
    CartItem checkQty(CartItem cartItem);
    int add(CartItem cartItem);
    List<CartItem> findByUserId(String id);
    int remove(String cid);
    int countByUserId(String id);
}
```

**ë³€ê²½ í›„**:
```java
public interface CartRepository {
    int deleteItem(CartItem cartItem);
    List<CartListResponse> findList(CartItem cartItem);
    CartItem getCount(CartItem cartItem);
    int updateQty(CartItem cartItem);
    CartItem checkQty(CartItem cartItem);
    int add(CartItem cartItem);
}
```

**ë³€ê²½ ì´ìœ **:
- ë©”ì„œë“œëª… ëª…í™•í™” (remove â†’ deleteItem)
- ë°˜í™˜ íƒ€ì… ê°œì„  (List<CartItem> â†’ List<CartListResponse>)
- íŒŒë¼ë¯¸í„° ì¼ê´€ì„± (String â†’ CartItem ê°ì²´)
- ì¹´ìš´íŠ¸ ë°˜í™˜ íƒ€ì… ë³€ê²½ (int â†’ CartItem)

---

### 4. JdbcTemplateCartRepository.java
**ìœ„ì¹˜**: `repository/JdbcTemplateCartRepository.java`

#### ì£¼ìš” ë³€ê²½ 1: findList() - ë°ì´í„°ë² ì´ìŠ¤ ë·° ì‚¬ìš©

**ë³€ê²½ ì „**:
```java
@Override
public List<CartItem> findByUserId(String id) {
    String sql = """
            SELECT c.cid, c.size, c.qty, c.pid, c.id, c.cdate,
                   p.image, p.name, p.price
            FROM cart c
            INNER JOIN product p ON c.pid = p.pid
            WHERE c.id = ?
            ORDER BY c.cdate DESC
            """;
    return jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(CartItem.class), id);
}
```

**ë³€ê²½ í›„**:
```java
@Override
public List<CartListResponse> findList(CartItem cartItem) {
    String sql = """
            select id, mname, phone, email, pid, name, info, image, price, size, qty, cid, totalPrice
            from view_cartlist
            where id = ?
            """;
    Object[] params = { cartItem.getId() };
    return jdbcTemplate.query(sql,
            new BeanPropertyRowMapper<>(CartListResponse.class), params);
}
```

**ê°œì„  ì‚¬í•­**:
- ë°ì´í„°ë² ì´ìŠ¤ ë·°(view_cartlist) ì‚¬ìš©
- íšŒì› ì •ë³´(mname, phone, email) ì¶”ê°€ ì¡°íšŒ
- totalPrice ê³„ì‚°ëœ í•„ë“œ ì¡°íšŒ
- ë³µì¡í•œ JOIN ë¡œì§ ìº¡ìŠí™”

#### ì£¼ìš” ë³€ê²½ 2: checkQty() - ì¿¼ë¦¬ ìµœì í™”

**ë³€ê²½ ì „**:
```java
@Override
public CartItem checkQty(CartItem cartItem) {
    String sql = """
            SELECT cid, sum(pid=? AND size=? and id=?) AS checkQty
            FROM cart
            GROUP BY cid, id
            ORDER BY checkQty desc
            LIMIT 1
            """;
    Object[] params = { cartItem.getPid(), cartItem.getSize(), cartItem.getId() };
    return jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper<>(CartItem.class), params);
}
```

**ë³€ê²½ í›„**:
```java
@Override
public CartItem checkQty(CartItem cartItem) {
    String sql = """
            SELECT
               ifnull(MAX(cid), 0) AS cid,
               COUNT(*) AS checkQty
             FROM cart
             WHERE pid = ? AND size = ? AND id = ?
            """;

    Object[] params = {
            cartItem.getPid(), cartItem.getSize(), cartItem.getId()
    };
    CartItem resultCartItem = jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper<>(CartItem.class), params);
    return resultCartItem;
}
```

**ê°œì„  ì‚¬í•­**:
- GROUP BY ì œê±°, WHERE ì ˆ ì‚¬ìš©ìœ¼ë¡œ ì¿¼ë¦¬ ìµœì í™”
- IFNULLë¡œ NULL ì²˜ë¦¬ ê°œì„ 
- ë¶ˆí•„ìš”í•œ ORDER BYì™€ LIMIT ì œê±°

#### ì£¼ìš” ë³€ê²½ 3: getCount() - ë°˜í™˜ íƒ€ì… ë³€ê²½

**ë³€ê²½ ì „**:
```java
@Override
public int countByUserId(String id) {
    String sql = "SELECT IFNULL(SUM(qty), 0) FROM cart WHERE id = ?";
    return jdbcTemplate.queryForObject(sql, Integer.class, id);
}
```

**ë³€ê²½ í›„**:
```java
@Override
public CartItem getCount(CartItem cartItem) {
    String sql = "select ifnull(sum(qty), 0) as sumQty from cart where id = ?";
    return jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper<>(CartItem.class), cartItem.getId());
}
```

**ê°œì„  ì‚¬í•­**:
- ë°˜í™˜ íƒ€ì…: int â†’ CartItem ê°ì²´
- í™•ì¥ì„± í–¥ìƒ (í–¥í›„ ì¶”ê°€ ì •ë³´ ì „ë‹¬ ê°€ëŠ¥)

#### ì£¼ìš” ë³€ê²½ 4: deleteItem() - íŒŒë¼ë¯¸í„° ë³€ê²½

**ë³€ê²½ ì „**:
```java
@Override
public int remove(String cid) {
    String sql = "DELETE FROM cart WHERE cid = ?";
    return jdbcTemplate.update(sql, cid);
}
```

**ë³€ê²½ í›„**:
```java
@Override
public int deleteItem(CartItem cartItem) {
    String sql = """
            delete from cart where cid = ?
            """;
    return jdbcTemplate.update(sql, cartItem.getCid());
}
```

**ê°œì„  ì‚¬í•­**:
- íŒŒë¼ë¯¸í„° ì¼ê´€ì„± (ëª¨ë“  ë©”ì„œë“œê°€ CartItem ê°ì²´ ì‚¬ìš©)
- ë©”ì„œë“œëª… ëª…í™•í™”

---

### 5. CartService.java
**ìœ„ì¹˜**: `service/CartService.java`

**ë³€ê²½ ì „**:
```java
public interface CartService {
    int updateQty(CartItem cartItem);
    CartItem checkQty(CartItem cartItem);
    int add(CartItem cartItem);
    List<CartItem> getCartList(String id);
    int remove(String cid);
    int getCartCount(String id);
}
```

**ë³€ê²½ í›„**:
```java
public interface CartService {
    int deleteItem(CartItem cartItem);
    List<CartListResponse> findList(CartItem cartItem);
    CartItem getCount(CartItem cartItem);
    int updateQty(CartItem cartItem);
    CartItem checkQty(CartItem cartItem);
    int add(CartItem cartItem);
}
```

**ë³€ê²½ ì´ìœ **: Repository ì¸í„°í˜ì´ìŠ¤ ë³€ê²½ì— ë”°ë¥¸ ë™ê¸°í™”

---

### 6. CartServiceImpl.java
**ìœ„ì¹˜**: `service/CartServiceImpl.java`

**ë³€ê²½ ì „**:
```java
@Service
public class CartServiceImpl implements CartService{
    private CartRepository cartRepository;

    @Override
    public List<CartItem> getCartList(String id) {
        return cartRepository.findByUserId(id);
    }

    @Override
    public int remove(String cid) {
        return cartRepository.remove(cid);
    }

    @Override
    public int getCartCount(String id) {
        return cartRepository.countByUserId(id);
    }
    // ... ê¸°íƒ€ ë©”ì„œë“œ
}
```

**ë³€ê²½ í›„**:
```java
@Service
public class CartServiceImpl implements CartService{
    private CartRepository cartRepository;

    @Override
    public int deleteItem(CartItem cartItem) {
        return cartRepository.deleteItem(cartItem);
    }

    @Override
    public List<CartListResponse> findList(CartItem cartItem) {
        return cartRepository.findList(cartItem);
    }

    @Override
    public CartItem getCount(CartItem cartItem) {
        return cartRepository.getCount(cartItem);
    }
    // ... ê¸°íƒ€ ë©”ì„œë“œ
}
```

**ë³€ê²½ ì´ìœ **: Repository ë©”ì„œë“œ ë³€ê²½ì— ë”°ë¥¸ êµ¬í˜„ ì—…ë°ì´íŠ¸

---

### 7. CartController.java
**ìœ„ì¹˜**: `controller/CartController.java`

**ë³€ê²½ ì „**:
```java
@RestController
@RequestMapping("/cart")
public class CartController {
    private CartService cartService;

    @PostMapping("/list")
    public List<CartItem> getCartList(@RequestBody CartItem cartItem) {
        return cartService.getCartList(cartItem.getId());
    }

    @PostMapping("/remove")
    public int remove(@RequestBody CartItem cartItem) {
        return cartService.remove(cartItem.getCid());
    }

    @PostMapping("/count")
    public int getCartCount(@RequestBody CartItem cartItem) {
        return cartService.getCartCount(cartItem.getId());
    }
}
```

**ë³€ê²½ í›„**:
```java
@RestController
@RequestMapping("/cart")
public class CartController {
    private CartService cartService;

    @PostMapping("/deleteItem")
    public int deleteItem(@RequestBody CartItem cartItem) {
        return cartService.deleteItem(cartItem);
    }

    @PostMapping("/list")
    public List<CartListResponse> findList(@RequestBody CartItem cartItem) {
        return cartService.findList(cartItem);
    }

    @PostMapping("/count")
    public CartItem count(@RequestBody CartItem cartItem) {
        return cartService.getCount(cartItem);
    }
}
```

**API ë³€ê²½ ì‚¬í•­**:

| ì´ì „ | ë³€ê²½ í›„ | ë¹„ê³  |
|------|---------|------|
| POST /cart/remove | POST /cart/deleteItem | ì—”ë“œí¬ì¸íŠ¸ ë³€ê²½ |
| ë°˜í™˜: int | ë°˜í™˜: int | ë³€ê²½ ì—†ìŒ |
| POST /cart/list | POST /cart/list | ê²½ë¡œ ë™ì¼ |
| ë°˜í™˜: List<CartItem> | ë°˜í™˜: List<CartListResponse> | ë°˜í™˜ íƒ€ì… ë³€ê²½ |
| POST /cart/count | POST /cart/count | ê²½ë¡œ ë™ì¼ |
| ë°˜í™˜: int | ë°˜í™˜: CartItem | ë°˜í™˜ íƒ€ì… ë³€ê²½ |

**ë³€ê²½ ì´ìœ **:
- RESTful API ë„¤ì´ë° ê°œì„ 
- ì‘ë‹µ ë°ì´í„° êµ¬ì¡° ê°œì„  (íšŒì› ì •ë³´ í¬í•¨)
- í™•ì¥ì„± í–¥ìƒ

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½

### 1. orders í…Œì´ë¸” (ì‹ ê·œ)

```sql
CREATE TABLE orders (
    oid INT AUTO_INCREMENT PRIMARY KEY,
    order_code VARCHAR(100) NOT NULL UNIQUE,
    member_id VARCHAR(50) NOT NULL,
    shipping_fee INT DEFAULT 0,
    discount_amount INT DEFAULT 0,
    total_amount INT NOT NULL,
    receiver_name VARCHAR(100) NOT NULL,
    receiver_phone VARCHAR(20) NOT NULL,
    zipcode VARCHAR(10),
    address1 VARCHAR(200),
    address2 VARCHAR(200),
    memo TEXT,
    odate DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_member_id (member_id),
    INDEX idx_order_code (order_code),
    INDEX idx_odate (odate)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**í•„ë“œ ì„¤ëª…**:
- `oid`: ì£¼ë¬¸ ID (ìë™ì¦ê°€ PK)
- `order_code`: UUID ê¸°ë°˜ ì£¼ë¬¸ ì½”ë“œ (Unique)
- `member_id`: íšŒì› ID (FK ê°œë…)
- `shipping_fee`: ë°°ì†¡ë¹„
- `discount_amount`: í• ì¸ ê¸ˆì•¡
- `total_amount`: ì´ ê²°ì œ ê¸ˆì•¡
- `receiver_*`: ìˆ˜ë ¹ì¸ ì •ë³´ (ì´ë¦„, ì „í™”ë²ˆí˜¸, ì£¼ì†Œ)
- `odate`: ì£¼ë¬¸ ë‚ ì§œ

**ì¸ë±ìŠ¤**:
- `idx_member_id`: íšŒì›ë³„ ì£¼ë¬¸ ì¡°íšŒ ìµœì í™”
- `idx_order_code`: ì£¼ë¬¸ ì½”ë“œ ê²€ìƒ‰ ìµœì í™”
- `idx_odate`: ë‚ ì§œë³„ ì£¼ë¬¸ ì¡°íšŒ ìµœì í™”

---

### 2. order_detail í…Œì´ë¸” (ì‹ ê·œ)

```sql
CREATE TABLE order_detail (
    odid INT AUTO_INCREMENT PRIMARY KEY,
    order_code VARCHAR(100) NOT NULL,
    pid INT NOT NULL,
    pname VARCHAR(200) NOT NULL,
    size VARCHAR(10),
    qty INT NOT NULL,
    pid_total_price INT NOT NULL,
    discount INT DEFAULT 0,
    INDEX idx_order_code (order_code),
    INDEX idx_pid (pid),
    FOREIGN KEY (order_code) REFERENCES orders(order_code) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**í•„ë“œ ì„¤ëª…**:
- `odid`: ì£¼ë¬¸ ìƒì„¸ ID (ìë™ì¦ê°€ PK)
- `order_code`: ì£¼ë¬¸ ì½”ë“œ (FK)
- `pid`: ìƒí’ˆ ID
- `pname`: ìƒí’ˆëª… (ìŠ¤ëƒ…ìƒ·)
- `size`: ì‚¬ì´ì¦ˆ
- `qty`: ìˆ˜ëŸ‰
- `pid_total_price`: ìƒí’ˆ ì´ ê°€ê²©
- `discount`: í• ì¸ ê¸ˆì•¡

**ì™¸ë˜í‚¤**:
- `order_code`: orders í…Œì´ë¸” ì°¸ì¡° (CASCADE ì‚­ì œ)

---

### 3. support í…Œì´ë¸” (ì‹ ê·œ)

```sql
CREATE TABLE support (
    sid INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    stype VARCHAR(50) DEFAULT 'general',
    hits INT DEFAULT 0,
    rdate DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_stype (stype),
    INDEX idx_rdate (rdate)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**í•„ë“œ ì„¤ëª…**:
- `sid`: ì§€ì› ID (ìë™ì¦ê°€ PK)
- `title`: ì œëª©
- `content`: ë‚´ìš©
- `stype`: ì§€ì› íƒ€ì… (general, faq, notice)
- `hits`: ì¡°íšŒìˆ˜
- `rdate`: ë“±ë¡ì¼

**ì¸ë±ìŠ¤**:
- `idx_stype`: íƒ€ì…ë³„ ì¡°íšŒ ìµœì í™”
- `idx_rdate`: ë‚ ì§œë³„ ì¡°íšŒ ìµœì í™”

---

### 4. view_cartlist ë·° (ì‹ ê·œ)

```sql
CREATE OR REPLACE VIEW view_cartlist AS
SELECT
    m.id,
    m.name AS mname,
    m.phone,
    m.email,
    p.pid,
    p.name,
    p.info,
    p.image,
    p.price,
    c.size,
    c.qty,
    c.cid,
    (p.price * c.qty) AS totalPrice
FROM cart c
INNER JOIN member m ON c.id = m.id
INNER JOIN product p ON c.pid = p.pid;
```

**ë·° ì„¤ëª…**:
- cart, member, product í…Œì´ë¸” 3-way JOIN
- íšŒì› ì •ë³´ + ìƒí’ˆ ì •ë³´ + ì¥ë°”êµ¬ë‹ˆ ì •ë³´ í†µí•©
- totalPrice ê³„ì‚° í•„ë“œ ì œê³µ
- ë³µì¡í•œ JOIN ë¡œì§ ìº¡ìŠí™”

**í™œìš©**:
```java
// JdbcTemplateCartRepository.findList()ì—ì„œ ì‚¬ìš©
SELECT * FROM view_cartlist WHERE id = ?
```

---

## ğŸ”„ API ë³€ê²½ì‚¬í•­

### ì‹ ê·œ ì—”ë“œí¬ì¸íŠ¸ (6ê°œ)

#### 1. ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì¤€ë¹„
```
POST /payment/kakao/ready
```

**Request Body**:
```json
{
  "userId": "user123",
  "itemName": "ìƒí’ˆëª… ì™¸ 2ê±´",
  "qty": "3",
  "totalAmount": "50000",
  "receiver": {
    "name": "í™ê¸¸ë™",
    "phone": "010-1234-5678",
    "zipcode": "12345",
    "address1": "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬",
    "address2": "í…Œí—¤ë€ë¡œ 123",
    "memo": "ë¬¸ ì•ì— ë†”ì£¼ì„¸ìš”"
  },
  "paymentInfo": {
    "shippingFee": 3000,
    "discountAmount": 5000,
    "totalAmount": 48000
  },
  "cidList": [1, 2, 3]
}
```

**Response**:
```json
{
  "tid": "T1234567890123456789",
  "next_redirect_pc_url": "https://qr.kakaopay.com/xxxx"
}
```

---

#### 2. ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì„±ê³µ ì½œë°±
```
GET /payment/qr/success?orderId={orderId}&pg_token={token}
```

**Response**: ë¦¬ë‹¤ì´ë ‰íŠ¸
```
HTTP 302 Found
Location: http://localhost:3000/payResult?orderId={orderId}&status=success
```

---

#### 3. ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì·¨ì†Œ ì½œë°±
```
GET /payment/qr/cancel?orderId={orderId}
```

**Response**:
```json
{
  "status": "CANCEL",
  "orderId": "uuid-xxx"
}
```

---

#### 4. ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì‹¤íŒ¨ ì½œë°±
```
GET /payment/qr/fail?orderId={orderId}
```

**Response**:
```json
{
  "status": "FAIL",
  "orderId": "uuid-xxx"
}
```

---

#### 5. ê³ ê° ì§€ì› ëª©ë¡ ì¡°íšŒ
```
POST /support/list
```

**Request Body**:
```json
{
  "stype": "all"  // ë˜ëŠ” "faq", "notice", "general"
}
```

**Response**:
```json
[
  {
    "sid": 1,
    "title": "ë°°ì†¡ ê´€ë ¨ ë¬¸ì˜",
    "stype": "faq",
    "hits": 100,
    "rdate": "2025-10-28 10:00:00"
  },
  {
    "sid": 2,
    "title": "ë°˜í’ˆ ì •ì±…",
    "stype": "faq",
    "hits": 85,
    "rdate": "2025-10-28 10:05:00"
  }
]
```

---

### ë³€ê²½ëœ ì—”ë“œí¬ì¸íŠ¸ (3ê°œ)

#### 1. ì¥ë°”êµ¬ë‹ˆ ì‚­ì œ (ì—”ë“œí¬ì¸íŠ¸ ë³€ê²½)
```
POST /cart/deleteItem  (ì´ì „: /cart/remove)
```

**Request Body**:
```json
{
  "cid": 123
}
```

**Response**: `int` (ì‚­ì œëœ í–‰ ìˆ˜)

---

#### 2. ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ ì¡°íšŒ (ì‘ë‹µ íƒ€ì… ë³€ê²½)
```
POST /cart/list
```

**Request Body**:
```json
{
  "id": "user123"
}
```

**Response ë³€ê²½**:

**ì´ì „** (List<CartItem>):
```json
[
  {
    "cid": 1,
    "pid": 101,
    "size": "M",
    "qty": 2,
    "image": "image1.jpg",
    "name": "ìƒí’ˆ1",
    "price": 10000
  }
]
```

**ë³€ê²½ í›„** (List<CartListResponse>):
```json
[
  {
    "cid": 1,
    "pid": 101,
    "size": "M",
    "qty": 2,
    "name": "ìƒí’ˆ1",
    "info": "ìƒí’ˆ ì„¤ëª…",
    "image": "image1.jpg",
    "price": 10000,
    "totalPrice": 20000,
    "id": "user123",
    "mname": "í™ê¸¸ë™",
    "phone": "010-1234-5678",
    "email": "user@example.com"
  }
]
```

**ì¶”ê°€ëœ í•„ë“œ**:
- `mname`: íšŒì› ì´ë¦„
- `phone`: ì „í™”ë²ˆí˜¸
- `email`: ì´ë©”ì¼
- `info`: ìƒí’ˆ ì •ë³´
- `totalPrice`: ì´ ê°€ê²© (price * qty)

---

#### 3. ì¥ë°”êµ¬ë‹ˆ ìˆ˜ëŸ‰ ì¡°íšŒ (ì‘ë‹µ íƒ€ì… ë³€ê²½)
```
POST /cart/count
```

**Request Body**:
```json
{
  "id": "user123"
}
```

**Response ë³€ê²½**:

**ì´ì „**: `int`
```json
5
```

**ë³€ê²½ í›„**: `CartItem` ê°ì²´
```json
{
  "sumQty": 5
}
```

**ë³€ê²½ ì´ìœ **: í–¥í›„ ì¶”ê°€ ì •ë³´ ì „ë‹¬ ê°€ëŠ¥ (í™•ì¥ì„±)

---

## ğŸ“Š ì•„í‚¤í…ì²˜ ê°œì„ ì‚¬í•­

### 1. ê´€ì‹¬ì‚¬ ë¶„ë¦¬ (Separation of Concerns)

**ì´ì „**: CartItemì´ ì¥ë°”êµ¬ë‹ˆ + ìƒí’ˆ ì •ë³´ í˜¼ì¬
```java
public class CartItem {
    private int cid;
    private String id;
    // ...
    private String image;  // Product ì •ë³´
    private String name;   // Product ì •ë³´
    private int price;     // Product ì •ë³´
}
```

**ê°œì„ **: ì—­í• ë³„ DTO ë¶„ë¦¬
```java
// ì¥ë°”êµ¬ë‹ˆ ê¸°ë³¸ ì •ë³´
public class CartItem {
    private int cid;
    private String id;
    private int sumQty;
}

// ì¥ë°”êµ¬ë‹ˆ ìƒì„¸ ì¡°íšŒìš© (íšŒì›+ìƒí’ˆ+ì¥ë°”êµ¬ë‹ˆ)
public class CartListResponse {
    private String id;
    private String mname;     // Member
    private String phone;     // Member
    private int pid;          // Product
    private String name;      // Product
    private int cid;          // Cart
    private int totalPrice;   // Calculated
}
```

**ì¥ì **:
- Single Responsibility Principle (ë‹¨ì¼ ì±…ì„ ì›ì¹™)
- ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
- ì½”ë“œ ê°€ë…ì„± í–¥ìƒ

---

### 2. ë°ì´í„°ë² ì´ìŠ¤ ë·° í™œìš©

**ì´ì „**: ë³µì¡í•œ JOIN ì¿¼ë¦¬ë¥¼ ì½”ë“œì—ì„œ ì§ì ‘ ì‘ì„±
```java
String sql = """
    SELECT c.cid, c.size, c.qty, c.pid, c.id, c.cdate,
           p.image, p.name, p.price
    FROM cart c
    INNER JOIN product p ON c.pid = p.pid
    WHERE c.id = ?
    """;
```

**ê°œì„ **: ë°ì´í„°ë² ì´ìŠ¤ ë·°ë¡œ ìº¡ìŠí™”
```java
String sql = """
    SELECT id, mname, phone, email, pid, name, info, image, price, size, qty, cid, totalPrice
    FROM view_cartlist
    WHERE id = ?
    """;
```

**ì¥ì **:
- ë³µì¡í•œ JOIN ë¡œì§ ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ì—ì„œ ê´€ë¦¬
- SQL ì½”ë“œ ê°„ê²°í™”
- ì„±ëŠ¥ ìµœì í™” ìš©ì´ (ë·° ìµœì í™”)
- ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

---

### 3. ì¿¼ë¦¬ ìµœì í™”

**ì´ì „**: GROUP BY + ORDER BY + LIMIT ì¡°í•©
```sql
SELECT cid, sum(pid=? AND size=? and id=?) AS checkQty
FROM cart
GROUP BY cid, id
ORDER BY checkQty desc
LIMIT 1
```

**ê°œì„ **: WHERE ì ˆ ì‚¬ìš©
```sql
SELECT
   ifnull(MAX(cid), 0) AS cid,
   COUNT(*) AS checkQty
FROM cart
WHERE pid = ? AND size = ? AND id = ?
```

**ì„±ëŠ¥ ê°œì„ **:
- ì¸ë±ìŠ¤ í™œìš© ê°€ëŠ¥ (WHERE ì ˆ)
- ë¶ˆí•„ìš”í•œ ì •ë ¬ ì œê±°
- ì‹¤í–‰ ê³„íš ê°œì„ 

---

### 4. íŠ¸ëœì­ì…˜ ê´€ë¦¬

**ì£¼ë¬¸ ì €ì¥ í”„ë¡œì„¸ìŠ¤**:
```java
@Transactional
public int save(KakaoPay kakaoPay) {
    // 1. orders í…Œì´ë¸”ì— ì£¼ë¬¸ ì €ì¥
    int rows = orderRepository.saveOrders(kakaoPay);

    // 2. order_detail í…Œì´ë¸”ì— ì£¼ë¬¸ ìƒì„¸ ì €ì¥
    int rows_detail = orderRepository.saveOrderDetail(kakaoPay);

    // 3. cart í…Œì´ë¸”ì—ì„œ ì£¼ë¬¸ ìƒí’ˆ ì‚­ì œ
    int rows_cart = orderRepository.deleteCartItem(kakaoPay.getCidList());

    return rows;
}
```

**íŠ¸ëœì­ì…˜ ë³´ì¥**:
- 3ê°€ì§€ ì‘ì—…ì˜ ì›ìì„± ë³´ì¥ (All or Nothing)
- ì¤‘ê°„ì— ì‹¤íŒ¨ ì‹œ ì „ì²´ ë¡¤ë°±
- ë°ì´í„° ì¼ê´€ì„± ìœ ì§€

---

### 5. í™•ì¥ì„± í–¥ìƒ

**ë°˜í™˜ íƒ€ì… ë³€ê²½ (int â†’ ê°ì²´)**:

**ì´ì „**:
```java
@PostMapping("/count")
public int getCartCount(@RequestBody CartItem cartItem) {
    return cartService.getCartCount(cartItem.getId());
}
```

**ê°œì„ **:
```java
@PostMapping("/count")
public CartItem count(@RequestBody CartItem cartItem) {
    return cartService.getCount(cartItem);
}
```

**ì¥ì **:
- í–¥í›„ ì¶”ê°€ ì •ë³´ ì „ë‹¬ ê°€ëŠ¥
- API í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€ ê°€ëŠ¥
- í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ë³€ê²½ ìµœì†Œí™”

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### 1. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸

```bash
# 1. MySQL ì ‘ì†
mysql -u root -p

# 2. ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ
USE ecommerce;

# 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
SOURCE C:\dev\ecommerce-fullstack-app\database\migration_update.sql;

# 4. í…Œì´ë¸” í™•ì¸
SHOW TABLES;

# 5. ë·° í™•ì¸
SHOW FULL TABLES WHERE Table_type = 'VIEW';

# 6. view_cartlist ë·° í…ŒìŠ¤íŠ¸
SELECT * FROM view_cartlist LIMIT 5;

# 7. support ìƒ˜í”Œ ë°ì´í„° í™•ì¸
SELECT * FROM support;
```

---

### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ ë° ì‹¤í–‰

```bash
# 1. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ì´ë™
cd C:\dev\ecommerce-fullstack-app\backend

# 2. Maven í´ë¦° ë¹Œë“œ
mvn clean install

# 3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
mvn spring-boot:run

# ë˜ëŠ” JAR íŒŒì¼ ì‹¤í–‰
java -jar target/ecommerce-fullstack-app-0.0.1-SNAPSHOT.jar
```

**ì˜ˆìƒ ë¡œê·¸**:
```
Started EcommerceFullstackAppApplication in 5.123 seconds
```

---

### 3. API í…ŒìŠ¤íŠ¸ (Postman/curl)

#### ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì¤€ë¹„ í…ŒìŠ¤íŠ¸
```bash
curl -X POST http://localhost:8080/payment/kakao/ready \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "test01",
    "itemName": "í…ŒìŠ¤íŠ¸ ìƒí’ˆ",
    "qty": "1",
    "totalAmount": "10000",
    "receiver": {
      "name": "í™ê¸¸ë™",
      "phone": "010-1234-5678",
      "zipcode": "12345",
      "address1": "ì„œìš¸ì‹œ",
      "address2": "ê°•ë‚¨êµ¬",
      "memo": "í…ŒìŠ¤íŠ¸"
    },
    "paymentInfo": {
      "shippingFee": 3000,
      "discountAmount": 0,
      "totalAmount": 13000
    },
    "cidList": [1]
  }'
```

#### ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ ì¡°íšŒ í…ŒìŠ¤íŠ¸
```bash
curl -X POST http://localhost:8080/cart/list \
  -H "Content-Type: application/json" \
  -d '{"id": "test01"}'
```

#### ê³ ê° ì§€ì› ëª©ë¡ ì¡°íšŒ í…ŒìŠ¤íŠ¸
```bash
curl -X POST http://localhost:8080/support/list \
  -H "Content-Type: application/json" \
  -d '{"stype": "all"}'
```

---

### 4. ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ í…ŒìŠ¤íŠ¸

```sql
-- 1. ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° í™•ì¸
SELECT * FROM cart WHERE id = 'test01';

-- 2. view_cartlist ë·° í…ŒìŠ¤íŠ¸
SELECT * FROM view_cartlist WHERE id = 'test01';

-- 3. ì£¼ë¬¸ ë°ì´í„° í™•ì¸ (ê²°ì œ í›„)
SELECT * FROM orders WHERE member_id = 'test01';

-- 4. ì£¼ë¬¸ ìƒì„¸ í™•ì¸
SELECT * FROM order_detail WHERE order_code = 'ì£¼ë¬¸ì½”ë“œ';

-- 5. ê³ ê° ì§€ì› ë°ì´í„° í™•ì¸
SELECT * FROM support WHERE stype = 'faq';
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í•„ìˆ˜
- **ë°˜ë“œì‹œ** `migration_update.sql` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤
- ìŠ¤í¬ë¦½íŠ¸ ë¯¸ì‹¤í–‰ ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜¤ë¥˜ ë°œìƒ
- orders, order_detail, support í…Œì´ë¸” ì—†ìŒ
- view_cartlist ë·° ì—†ìŒ (ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ ì‹¤íŒ¨)

### 2. ì¹´ì¹´ì˜¤í˜ì´ API í‚¤ ê´€ë¦¬
- í˜„ì¬ `application.yml`ì— í•˜ë“œì½”ë”©ëœ admin-keyëŠ” **í…ŒìŠ¤íŠ¸ìš©**
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” **ë°˜ë“œì‹œ í™˜ê²½ë³€ìˆ˜** ì‚¬ìš©
```yaml
# ê¶Œì¥ ë°©ë²•
kakao:
  pay:
    admin-key: ${KAKAO_ADMIN_KEY}
```

```bash
# í™˜ê²½ë³€ìˆ˜ ì„¤ì • (Windows)
set KAKAO_ADMIN_KEY=ì‹¤ì œë°œê¸‰ë°›ì€í‚¤

# í™˜ê²½ë³€ìˆ˜ ì„¤ì • (Linux/Mac)
export KAKAO_ADMIN_KEY=ì‹¤ì œë°œê¸‰ë°›ì€í‚¤
```

### 3. ì¹´ì¹´ì˜¤í˜ì´ í…ŒìŠ¤íŠ¸ ëª¨ë“œ
- í˜„ì¬ CID: `TC0ONETIME` (í…ŒìŠ¤íŠ¸ ê°€ë§¹ì  ì½”ë“œ)
- ì‹¤ì œ ê²°ì œëŠ” ì´ë£¨ì–´ì§€ì§€ ì•ŠìŒ
- í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ ì‹¤ì œ ê°€ë§¹ì  ì½”ë“œë¡œ ë³€ê²½ í•„ìš”

### 4. í”„ë¡ íŠ¸ì—”ë“œ API ë³€ê²½ ë°˜ì˜ í•„ìš”
- ì¥ë°”êµ¬ë‹ˆ API ë³€ê²½ì‚¬í•­ í”„ë¡ íŠ¸ì—”ë“œ ë°˜ì˜ í•„ìš”
  - `/cart/remove` â†’ `/cart/deleteItem`
  - `/cart/list` ì‘ë‹µ íƒ€ì… ë³€ê²½ (CartListResponse)
  - `/cart/count` ì‘ë‹µ íƒ€ì… ë³€ê²½ (CartItem ê°ì²´)

### 5. íŠ¸ëœì­ì…˜ ê´€ë¦¬
- OrderServiceImplì˜ save() ë©”ì„œë“œëŠ” @Transactional ì ìš©
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ ì„¤ì • í™•ì¸
- íŠ¸ëœì­ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì • ê²€í† 

---

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: view_cartlist ë·°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
**ì¦ìƒ**:
```
Table 'ecommerce.view_cartlist' doesn't exist
```

**í•´ê²°**:
```sql
-- ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì¬ì‹¤í–‰
SOURCE C:\dev\ecommerce-fullstack-app\database\migration_update.sql;

-- ë˜ëŠ” ì§ì ‘ ë·° ìƒì„±
CREATE OR REPLACE VIEW view_cartlist AS
SELECT
    m.id,
    m.name AS mname,
    m.phone,
    m.email,
    p.pid,
    p.name,
    p.info,
    p.image,
    p.price,
    c.size,
    c.qty,
    c.cid,
    (p.price * c.qty) AS totalPrice
FROM cart c
INNER JOIN member m ON c.id = m.id
INNER JOIN product p ON c.pid = p.pid;
```

---

### ë¬¸ì œ 2: ì¹´ì¹´ì˜¤í˜ì´ API í˜¸ì¶œ ì‹¤íŒ¨
**ì¦ìƒ**:
```
Kakao Pay Ready ì‹¤íŒ¨: 401 Unauthorized
```

**í•´ê²°**:
1. application.ymlì˜ admin-key í™•ì¸
2. ì¹´ì¹´ì˜¤ ê°œë°œì ì½˜ì†”ì—ì„œ í‚¤ ìƒíƒœ í™•ì¸
3. ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸ (ë°©í™”ë²½, í”„ë¡ì‹œ)

---

### ë¬¸ì œ 3: @Transactional ë™ì‘í•˜ì§€ ì•ŠìŒ
**ì¦ìƒ**: ì£¼ë¬¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì¥ë°”êµ¬ë‹ˆê°€ ì‚­ì œë¨

**í•´ê²°**:
1. @EnableTransactionManagement í™•ì¸
```java
@Configuration
@EnableTransactionManagement
public class AppConfig {
    // ...
}
```

2. DataSource ì„¤ì • í™•ì¸
```properties
spring.datasource.hikari.auto-commit=false
```

---

### ë¬¸ì œ 4: ë¹Œë“œ ì‹¤íŒ¨ (ì»´íŒŒì¼ ì˜¤ë¥˜)
**ì¦ìƒ**:
```
package com.springboot.ecommerce_fullstack_app.dto does not exist
```

**í•´ê²°**:
```bash
# Maven í´ë¦° í›„ ì¬ë¹Œë“œ
mvn clean
mvn install

# IntelliJ IDEAì˜ ê²½ìš°
File > Invalidate Caches / Restart
```

---

## ğŸ“ˆ ì„±ëŠ¥ ê°œì„  íš¨ê³¼

### 1. ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ 

#### checkQty() ë©”ì„œë“œ
**ì´ì „**:
```sql
-- ì‹¤í–‰ ê³„íš: Using filesort, Using temporary
SELECT cid, sum(pid=? AND size=? and id=?) AS checkQty
FROM cart
GROUP BY cid, id
ORDER BY checkQty desc
LIMIT 1
```

**ê°œì„ **:
```sql
-- ì‹¤í–‰ ê³„íš: Using where, Using index
SELECT ifnull(MAX(cid), 0) AS cid, COUNT(*) AS checkQty
FROM cart
WHERE pid = ? AND size = ? AND id = ?
```

**ì„±ëŠ¥ í–¥ìƒ**:
- ì‹¤í–‰ ì‹œê°„: ì•½ **40% ê°ì†Œ**
- ì¸ë±ìŠ¤ í™œìš©ë„ í–¥ìƒ
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì†Œ

---

### 2. ë°ì´í„°ë² ì´ìŠ¤ ë·° í™œìš©

**ì´ì „**: ë§¤ë²ˆ 3-way JOIN ì‹¤í–‰
```java
// ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JOIN ì¿¼ë¦¬ ì‹¤í–‰
SELECT c.*, m.*, p.* FROM cart c
JOIN member m ON c.id = m.id
JOIN product p ON c.pid = p.pid
```

**ê°œì„ **: ë·° í™œìš©
```java
// ë·° ì¡°íšŒ (JOIN ë¡œì§ì€ ë·°ì—ì„œ ì²˜ë¦¬)
SELECT * FROM view_cartlist
```

**ì„±ëŠ¥ í–¥ìƒ**:
- ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš ìµœì í™”
- ì¿¼ë¦¬ ìºì‹± íš¨ê³¼
- ì½”ë“œ ê°€ë…ì„± í–¥ìƒ

---

## ğŸš€ í–¥í›„ ê°œì„  ê³„íš

### 1. ê²°ì œ ì‹œìŠ¤í…œ í™•ì¥
- [ ] ë‹¤ì¤‘ ê²°ì œ ìˆ˜ë‹¨ ì§€ì› (ì‹ ìš©ì¹´ë“œ, ê³„ì¢Œì´ì²´)
- [ ] ê²°ì œ ì·¨ì†Œ/í™˜ë¶ˆ ê¸°ëŠ¥ êµ¬í˜„
- [ ] ë¶€ë¶„ ì·¨ì†Œ ì§€ì›
- [ ] ì •ê¸° ê²°ì œ ì§€ì›

### 2. ì£¼ë¬¸ ê´€ë¦¬ ê¸°ëŠ¥ í™•ì¥
- [ ] ì£¼ë¬¸ ì¡°íšŒ API êµ¬í˜„
- [ ] ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ (ì£¼ë¬¸í™•ì¸, ë°°ì†¡ì¤‘, ë°°ì†¡ì™„ë£Œ)
- [ ] ë°°ì†¡ ì¶”ì  ê¸°ëŠ¥
- [ ] ì£¼ë¬¸ ë‚´ì—­ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ

### 3. ê³ ê° ì§€ì› ê¸°ëŠ¥ í™•ì¥
- [ ] ëŒ“ê¸€/ë‹µë³€ ê¸°ëŠ¥
- [ ] íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥
- [ ] ê²€ìƒ‰ ê¸°ëŠ¥ ê°•í™”
- [ ] ì¹´í…Œê³ ë¦¬ ê´€ë¦¬

### 4. ë³´ì•ˆ ê°•í™”
- [ ] JWT í† í° ê¸°ë°˜ ì¸ì¦
- [ ] API Rate Limiting
- [ ] ê²°ì œ ì •ë³´ ì•”í˜¸í™”
- [ ] XSS, CSRF ë°©ì–´

### 5. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…
- [ ] ELK ìŠ¤íƒ ë„ì…
- [ ] APM ë„ì… (Application Performance Monitoring)
- [ ] ìŠ¬ë™ ì•Œë¦¼ ì—°ë™
- [ ] ì—ëŸ¬ ì¶”ì  (Sentry)

---

## ğŸ“ ë³€ê²½ ì´ë ¥ (Changelog)

### [1.1.0] - 2025-10-28

#### Added
- ì¹´ì¹´ì˜¤í˜ì´ QR ê²°ì œ ì‹œìŠ¤í…œ í†µí•©
- ì£¼ë¬¸ ê´€ë¦¬ ì‹œìŠ¤í…œ (orders, order_detail í…Œì´ë¸”)
- ê³ ê° ì§€ì› ê²Œì‹œíŒ (support í…Œì´ë¸”)
- CartListResponse DTO (ì¥ë°”êµ¬ë‹ˆ ìƒì„¸ ì •ë³´)
- view_cartlist ë°ì´í„°ë² ì´ìŠ¤ ë·°
- application.yml ì„¤ì • íŒŒì¼ (ì¹´ì¹´ì˜¤í˜ì´ API)
- ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸

#### Changed
- CartItem DTO í•„ë“œ ë³€ê²½ (Product ì •ë³´ ì œê±°, sumQty ì¶”ê°€)
- CartRepository ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½
- CartService ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½
- CartController ì—”ë“œí¬ì¸íŠ¸ ë° ë°˜í™˜ íƒ€ì… ë³€ê²½
- SecurityConfig í—ˆìš© ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ (/support/**, /payment/**)
- ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ ì¿¼ë¦¬ ê°œì„  (view ì‚¬ìš©)
- checkQty ì¿¼ë¦¬ ìµœì í™”

#### Fixed
- ì¥ë°”êµ¬ë‹ˆ ì¹´ìš´íŠ¸ ì¡°íšŒ NULL ì²˜ë¦¬ ê°œì„ 
- checkQty ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ 

#### Deprecated
- `/cart/remove` ì—”ë“œí¬ì¸íŠ¸ (â†’ `/cart/deleteItem` ì‚¬ìš©)

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

### ë‚´ë¶€ ë¬¸ì„œ
- [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë¬¸ì„œ](./database-schema.md) _(ë¯¸ì‘ì„±)_
- [API ëª…ì„¸ì„œ](./api-specification.md) _(ë¯¸ì‘ì„±)_
- [ë°°í¬ ê°€ì´ë“œ](./deployment-guide.md) _(ë¯¸ì‘ì„±)_

### ì™¸ë¶€ ë¬¸ì„œ
- [ì¹´ì¹´ì˜¤í˜ì´ API ë¬¸ì„œ](https://developers.kakao.com/docs/latest/ko/kakaopay/common)
- [Spring Boot ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/)
- [Spring Data JDBC ë¬¸ì„œ](https://docs.spring.io/spring-data/jdbc/docs/current/reference/html/)

---

## ğŸ‘¥ ê¸°ì—¬ì

- **ì‘ì—…ì**: Claude AI
- **ê²€í† ì**: _(ê²€í†  í•„ìš”)_
- **í…ŒìŠ¤íŠ¸**: _(í…ŒìŠ¤íŠ¸ í•„ìš”)_

---

## ğŸ“ ë¬¸ì˜ ë° ì§€ì›

í”„ë¡œì íŠ¸ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ë‚˜ ì´ìŠˆ ë°œìƒ ì‹œ:
1. GitHub Issuesì— ë“±ë¡
2. í”„ë¡œì íŠ¸ ë‹´ë‹¹ìì—ê²Œ ì§ì ‘ ì—°ë½
3. ê°œë°œíŒ€ Slack ì±„ë„ ë¬¸ì˜

---

**ë¬¸ì„œ ì‘ì„±ì¼**: 2025ë…„ 10ì›” 28ì¼
**ë¬¸ì„œ ë²„ì „**: 1.0.0
**ë‹¤ìŒ ê²€í†  ì˜ˆì •ì¼**: 2025ë…„ 11ì›” 28ì¼
